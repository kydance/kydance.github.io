<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>浅析现代化命令行框架 Cobra - Kyden 杂货铺</title><meta name="Description" content="Kyden&#39;s Blog Site"><meta property="og:url" content="https://kydance.github.io/posts/go-cobra/">
  <meta property="og:site_name" content="Kyden 杂货铺">
  <meta property="og:title" content="浅析现代化命令行框架 Cobra">
  <meta property="og:description" content="导语 Cobra 是一个可以创建强大的现代化 CLI 应用程序库，它还提供了一个可以生成应用和命令文件的程序的命令行工具：cobra-cli.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-21T09:55:48+08:00">
    <meta property="article:modified_time" content="2024-09-21T09:55:48+08:00">
    <meta property="article:tag" content="现代化">
    <meta property="article:tag" content="命令行">
    <meta property="article:tag" content="框架">
    <meta property="article:tag" content="Cobra">
    <meta property="article:tag" content="CLI">
    <meta property="og:image" content="https://kydance.github.io/favicon.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://kydance.github.io/favicon.png">
  <meta name="twitter:title" content="浅析现代化命令行框架 Cobra">
  <meta name="twitter:description" content="导语 Cobra 是一个可以创建强大的现代化 CLI 应用程序库，它还提供了一个可以生成应用和命令文件的程序的命令行工具：cobra-cli.">
<meta name="application-name" content="Kyden">
<meta name="apple-mobile-web-app-title" content="Kyden"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="canonical" href="https://kydance.github.io/posts/go-cobra/" /><link rel="prev" href="https://kydance.github.io/posts/regex-in-one/" /><link rel="next" href="https://kydance.github.io/posts/go-viper/" /><link rel="stylesheet" href="/css/style.min.cf6878db51c51b2d04ae155284a4403dbee8db33e16c066f954c95279c271fcd.css" integrity="sha256-z2h421HFGy0ErhVShKRAPb7o2zPhbAZvlUyVJ5wnH80="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "浅析现代化命令行框架 Cobra",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/kydance.github.io\/posts\/go-cobra\/"
        },"image": ["https:\/\/kydance.github.io\/favicon.ico"],"genre": "posts","keywords": "现代化, 命令行, 框架, Cobra, CLI","wordcount":  1447 ,
        "url": "https:\/\/kydance.github.io\/posts\/go-cobra\/","datePublished": "2024-09-21T09:55:48+08:00","dateModified": "2024-09-21T09:55:48+08:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "kyden","logo": "https:\/\/kydance.github.io\/favicon.png"},"author": {
                "@type": "Person",
                "name": "kyden"
            },"description": ""
    }
    </script>
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-M1S0PTJ6RH"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-M1S0PTJ6RH');
        </script>
    </head>

    <body data-header-desktop="auto" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Kyden 杂货铺"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/favicon.ico"
        data-srcset="/favicon.ico, /favicon.ico 1.5x, /favicon.ico 2x"
        data-sizes="auto"
        alt="/favicon.ico"
        title="/favicon.ico" />Kyden Grocery</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="https://github.com/kydance" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Type Something..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Kyden 杂货铺"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/favicon.ico"
        data-srcset="/favicon.ico, /favicon.ico 1.5x, /favicon.ico 2x"
        data-sizes="auto"
        alt="/favicon.ico"
        title="/favicon.ico" />Kyden Grocery</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Type Something..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="https://github.com/kydance" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">浅析现代化命令行框架 Cobra</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https:github.com/kydance" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>kyden</a></span>&nbsp;<span class="post-category">included in <a href="/categories/%E7%8E%B0%E4%BB%A3%E5%8C%96/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>现代化</a>&nbsp;<a href="/categories/%E5%91%BD%E4%BB%A4%E8%A1%8C/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>命令行</a>&nbsp;<a href="/categories/%E6%A1%86%E6%9E%B6/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>框架</a>&nbsp;<a href="/categories/cobra/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>Cobra</a>&nbsp;<a href="/categories/cli/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>CLI</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2024-09-21">2024-09-21</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;1447 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#i-cobra-简介">I. Cobra 简介</a></li>
    <li><a href="#ii-cobra-cli-命令安装">II. <code>cobra-cli</code> 命令安装</a></li>
    <li><a href="#iii-cobra-使用">III. Cobra 使用</a>
      <ul>
        <li><a href="#使用-cobra-cli-命令生成应用程序并添加子命令">使用 <code>cobra-cli</code> 命令生成应用程序并添加子命令</a>
          <ul>
            <li><a href="#1-初始化应用程序">1. 初始化应用程序</a></li>
            <li><a href="#2-添加子命令">2. 添加子命令</a></li>
            <li><a href="#3-编译运行">3. 编译运行</a></li>
            <li><a href="#4-配置-cobra">4. 配置 cobra</a></li>
          </ul>
        </li>
        <li><a href="#使用-cobra-库创建命令">使用 <code>cobra</code> 库创建命令</a></li>
        <li><a href="#使用标志">使用标志</a></li>
      </ul>
    </li>
    <li><a href="#iv-reference">IV. Reference</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><div class="details admonition abstract open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-list-ul fa-fw" aria-hidden="true"></i>导语<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><strong>Cobra</strong> 是一个可以创建强大的现代化 CLI 应用程序库，它还提供了一个可以生成应用和命令文件的程序的命令行工具：<code>cobra-cli</code>.</div>
        </div>
    </div>
<h2 id="i-cobra-简介">I. Cobra 简介</h2>
<p><strong>Cobra</strong> 是一个可以创建强大的现代化 CLI 应用程序库，它还提供了一个可以生成应用和命令文件的程序的命令行工具：<code>cobra-cli</code>。
许多大型项目（e.g. kubernetes, Docker, Etcd, Rkt, Hugo etc.）都采用了 cobra 来构建他们的应用程序。</p>
<figure><img src="/posts/go-cobra/CobraMain.png">
</figure>

<p>Cobra 具有很多特性，一些核心特性如下：</p>
<ul>
<li>可以构建基于子命令的 CLI，并支持嵌套子命令：<code>app server</code>, <code>app fetch</code></li>
<li>可以通过 <code>cobra-cli init appname &amp; cobra-cli add cmdname</code> 轻松生成应用和子命令</li>
<li>智能化命令建议：<code>app srver...did you mean app server</code></li>
<li>自动生成命令和标志的 helpe 文本，并能自动识别 <code>-h</code>, <code>--help</code> 等标志</li>
<li>自动为应用程序生成 bash、zsh、fish、powershell 自动补全脚本</li>
<li>支持命令别名、自定义帮助、自定义用法等</li>
<li>可以与 viper、pflag 紧密集成，用于构建 12-factor 应用程序</li>
</ul>
<p>Cobra 建立在 commands、arguments 和 flags 结构之上。Commands 代表命令，arguments 代表非选项参数，flags 代表选项参数（标志）。</p>
<div class="details admonition Tips open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-pencil-alt fa-fw" aria-hidden="true"></i>CLI 模式<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><p>一个好的应用程序应该是易懂的，用户可以清晰知道如何去使用这个应用程序，因此通常遵循如下模式：
<code>APPNAME VERB NOUN --ADJECTIVE</code> 或者 <code>APPNAME COMMAND ARG --FLAG</code>，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># clone 是一个 Commands</span>
</span></span><span class="line"><span class="cl"><span class="c1"># URL 是一个非选项参数</span>
</span></span><span class="line"><span class="cl"><span class="c1"># bare 一个选项参数</span>
</span></span><span class="line"><span class="cl">git clone URL --bare
</span></span></code></pre></td></tr></table>
</div>
</div><p>NOTE：<code>VERB</code> 代表动词，<code>NOUN</code> 代表名词，<code>ADJECTIVE</code> 代表形容词</p>
</div>
        </div>
    </div>
<h2 id="ii-cobra-cli-命令安装">II. <code>cobra-cli</code> 命令安装</h2>
<p>Cobra 提供了 <code>cobra-cli</code> 命令，用来初始化一个应用程序并为其添加命令，方便开发基于 Cobra 的应用，可用以下方法进行安装：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go install github.com/spf13/cobra-cli@latest
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>cobra-cli</code> 提供了 4 个子命令：</p>
<ul>
<li><code>init</code>: 初始化一个 cobra 应用程序</li>
<li><code>add</code>: 给通过 cobra init 创建的应用程序添加子命令</li>
<li><code>completion</code>: 为指定的 shell 生成命令自动补全脚本</li>
<li><code>help</code>: 打印任意命令的帮助信息</li>
</ul>
<p><code>cobra-cli</code> 还提供了一些全局参数：</p>
<ul>
<li><code>-a</code>, <code>--author</code>: 指定 Copyright 版权声明中的作者</li>
<li><code>--config</code>: 指定 cobra 配置文件的路径</li>
<li><code>-l</code>, <code>--license</code>: 指定生成的应用程序所使用的开源协议，内置的有：GPLv2, GPLv3, LGPL, AGPL, MIT, 2-Clause BSD or 3-Clause BSD；</li>
<li><code>--viper</code>: 使用 viper 作为命令行参数解析工具，默认为 true。</li>
</ul>
<h2 id="iii-cobra-使用">III. Cobra 使用</h2>
<p>在构建 cobra 应用时，可以自行组织代码目录结构，但 cobra 建议如下目录结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree app_name
</span></span><span class="line"><span class="cl">app_name
</span></span><span class="line"><span class="cl">├── cmd
</span></span><span class="line"><span class="cl">│   ├── add.go
</span></span><span class="line"><span class="cl">│   ├── create.go
</span></span><span class="line"><span class="cl">│   └── list.go
</span></span><span class="line"><span class="cl">└── main.go
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>main.go</code> 文件的目的只有一个：初始化 cobra 应用程序并注册子命令</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;{pathtToApp}/cmd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cmd</span><span class="p">.</span><span class="nf">Execute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用-cobra-cli-命令生成应用程序并添加子命令">使用 <code>cobra-cli</code> 命令生成应用程序并添加子命令</h3>
<p>可以选择使用 <code>cobra-cli</code> 命令行工具快速生成一个应用程序，并添加子命令，然后基于生成的代码进行二次开发，提高开发效率，具体方法如下：</p>
<h4 id="1-初始化应用程序">1. 初始化应用程序</h4>
<p>使用 <code>cobra-cli init</code> 命令初始化一个应用程序，然后就可以基于这个 Demo 进行二次开发，提高开发效率：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir -p kyden-demo <span class="o">&amp;&amp;</span> <span class="nb">cd</span> kydne-demo <span class="o">&amp;&amp;</span> go mod init kyden-demo
</span></span><span class="line"><span class="cl">$ cobra-cli init --license<span class="o">=</span>MIT --viper
</span></span><span class="line"><span class="cl">$ ls
</span></span><span class="line"><span class="cl">cmd  go.mod  go.sum  LICENSE  main.go
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-添加子命令">2. 添加子命令</h4>
<p>当一个应用程序初始化完成之后，就可以使用 <code>cobra-cli add</code> 命令添加一些命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cobra-cli add serve
</span></span><span class="line"><span class="cl">$ cobra-cli add config
</span></span><span class="line"><span class="cl">$ cobra-cli add create -p <span class="s1">&#39;configCmd&#39;</span> <span class="c1"># 此命令的父命令的变量名（默认为 &#39;rootCmd&#39;）</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ tree kyden-demo 
</span></span><span class="line"><span class="cl">kyden-demo
</span></span><span class="line"><span class="cl">├── LICENSE
</span></span><span class="line"><span class="cl">├── cmd
</span></span><span class="line"><span class="cl">│   ├── config.go
</span></span><span class="line"><span class="cl">│   ├── create.go
</span></span><span class="line"><span class="cl">│   ├── root.go
</span></span><span class="line"><span class="cl">│   └── serve.go
</span></span><span class="line"><span class="cl">├── go.mod
</span></span><span class="line"><span class="cl">├── go.sum
</span></span><span class="line"><span class="cl">└── main.go
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行 <code>cobra-cli add</code> 命令之后，会在 <code>cmd</code> 目录下生成命令源码文件。
<code>cobra-cli</code> 不仅可以添加命令，也可以添加子命令，例如 <code>cobra-cli add create -p 'configCmd'</code> 给 <code>config</code> 命令添加了 <code>create</code> 子命令，<code>-p</code> 指定子命令的父命令：<code>&lt;父命令&gt;Cmd</code>.</p>
<h4 id="3-编译运行">3. 编译运行</h4>
<p>在生成命令后，可以直接执行 <code>go build</code> 命令编译应用程序：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ go build -v .
</span></span><span class="line"><span class="cl">$ ./kyden-demo -h
</span></span><span class="line"><span class="cl">A longer description that spans multiple lines and likely contains
</span></span><span class="line"><span class="cl">examples and usage of using your application. For example:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Cobra is a CLI library <span class="k">for</span> Go that empowers applications.
</span></span><span class="line"><span class="cl">This application is a tool to generate the needed files
</span></span><span class="line"><span class="cl">to quickly create a Cobra application.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Usage:
</span></span><span class="line"><span class="cl">  kyden-demo <span class="o">[</span>command<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Available Commands:
</span></span><span class="line"><span class="cl">  completion  Generate the autocompletion script <span class="k">for</span> the specified shell
</span></span><span class="line"><span class="cl">  config      A brief description of your <span class="nb">command</span>
</span></span><span class="line"><span class="cl">  <span class="nb">help</span>        Help about any <span class="nb">command</span>
</span></span><span class="line"><span class="cl">  serve       A brief description of your <span class="nb">command</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Flags:
</span></span><span class="line"><span class="cl">      --config string   config file <span class="o">(</span>default is <span class="nv">$HOME</span>/.kyden-demo.yaml<span class="o">)</span>
</span></span><span class="line"><span class="cl">  -h, --help            <span class="nb">help</span> <span class="k">for</span> kyden-demo
</span></span><span class="line"><span class="cl">  -t, --toggle          Help message <span class="k">for</span> toggle
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Use <span class="s2">&#34;kyden-demo [command] --help&#34;</span> <span class="k">for</span> more information about a command.
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="4-配置-cobra">4. 配置 cobra</h4>
<p><code>cobra</code> 在生成应用程序时，也会在当前目录下生成 <code>LINCENSE</code> 文件，并且会在生成的 Go 源码文件中中，添加 LINCENSE Header。</p>
<p>LINCENSE 和 LINCENSE Header 的内容可以通过 cobra 配置文进行配置，默认配置文件 <code>~/.cobra.yaml</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ cat ~/.cobra.yaml
</span></span><span class="line"><span class="cl">author: Kyden &lt;kytedance@gmail.com&gt;
</span></span><span class="line"><span class="cl">year: <span class="m">2024</span>
</span></span><span class="line"><span class="cl">license:
</span></span><span class="line"><span class="cl">  header: This file is part of CLI application foo.
</span></span><span class="line"><span class="cl">  text: <span class="p">|</span>
</span></span><span class="line"><span class="cl">    <span class="o">{{</span> .copyright <span class="o">}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    This is my license. There are many like it, but this one is mine.
</span></span><span class="line"><span class="cl">    My license is my best friend. It is my life. I must master it as I must
</span></span><span class="line"><span class="cl">    master my life.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cobra-cli init
</span></span><span class="line"><span class="cl">Copyright © <span class="m">2024</span> Kyden &lt;kytedance@gmail.com&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">This is my license. There are many like it, but this one is mine.
</span></span><span class="line"><span class="cl">My license is my best friend. It is my life. I must master it as I must
</span></span><span class="line"><span class="cl">master my life.
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>{{ .copyright }}</code> 的具体内容会根据 <code>author</code> 和 <code>year</code> 生成，根据此配置生成的 LICENSE 文件内容.</p>
<p>也可以使用内建的 licenses，内建的 licenses 有：GPLv2, GPLv3, LGPL, AGPL, MIT, 2-Clause BSD or 3-Clause BSD。</p>
<h3 id="使用-cobra-库创建命令">使用 <code>cobra</code> 库创建命令</h3>
<p>当使用 cobra 库编码实现一个应用程序，需要首选创建一个空的 <code>main.go</code> 文件和一个 rootCmd 文件，然后根据需要添加其他命令。</p>
<p>具体步骤如下：</p>
<ol>
<li>创建 rootCmd</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ mkdir -p cobrademo <span class="o">&amp;&amp;</span> cobrademo
</span></span><span class="line"><span class="cl">$ go mod init cobrademo
</span></span><span class="line"><span class="cl">go: creating new go.mod: module cobrademo
</span></span><span class="line"><span class="cl">go: to add module requirements and sums:
</span></span><span class="line"><span class="cl">        go mod tidy
</span></span><span class="line"><span class="cl">$ cobra-cli init
</span></span><span class="line"><span class="cl">Using config file: /Users/kyden/.cobra.yml
</span></span><span class="line"><span class="cl">Your Cobra application is ready at
</span></span><span class="line"><span class="cl">/tmp/cobrademo
</span></span></code></pre></td></tr></table>
</div>
</div><p>通常情况下，会将 <code>rootCmd</code> 放在 <code>cmd/root.go</code> 文件中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">Copyright © 2024 Kyden &lt;kytedance@gmail.com&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">This file is part of CLI application foo.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">cmd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;os&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// rootCmd represents the base command when called without any subcommands
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">rootCmd</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Use</span><span class="p">:</span>   <span class="s">&#34;cobrademo&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Short</span><span class="p">:</span> <span class="s">&#34;A brief description of your application&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Long</span><span class="p">:</span> <span class="s">`A longer description that spans multiple lines and likely contains
</span></span></span><span class="line"><span class="cl"><span class="s">examples and usage of using your application. For example:
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Cobra is a CLI library for Go that empowers applications.
</span></span></span><span class="line"><span class="cl"><span class="s">This application is a tool to generate the needed files
</span></span></span><span class="line"><span class="cl"><span class="s">to quickly create a Cobra application.`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// Do stuff here
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Execute adds all child commands to the root command and sets flags appropriately.
</span></span></span><span class="line"><span class="cl"><span class="c1">// This is called by main.main(). It only needs to happen once to the rootCmd.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">Execute</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">rootCmd</span><span class="p">.</span><span class="nf">Execute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Here you will define your flags and configuration settings.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Cobra supports persistent flags, which, if defined here,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// will be global for your application.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// rootCmd.PersistentFlags().StringVar(&amp;cfgFile, &#34;config&#34;, &#34;&#34;, &#34;config file (default is $HOME/.cobrademo.yaml)&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Cobra also supports local flags, which will only run
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// when this action is called directly.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">rootCmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">BoolP</span><span class="p">(</span><span class="s">&#34;toggle&#34;</span><span class="p">,</span> <span class="s">&#34;t&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;Help message for toggle&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>还可以在 <code>init()</code> 函数中定义标志和处理配置，例如：<code>cmd/helper.go</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>创建 <code>main.go</code></li>
</ol>
<p>还需要一个 main 函数来调用 rootCmd，通常会创建一个 <code>main.go</code> 文件，在 <code>main.go</code> 中调用 <code>rootCmd.Execute()</code> 来执行命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="s">&#34;{pathToApp}/cmd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cmd</span><span class="p">.</span><span class="nf">Execute</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 <code>main.go</code> 中不建议放太多代码，通常只需要调用 <code>cmd.Execute()</code> 即可</p>
<ol start="3">
<li>添加命令</li>
</ol>
<p>除了 <code>rootCmd</code>，还可以调用 <code>AddCommand()</code> 来添加其他命令，通常情况下，会把其他命令的源码文件放在 <code>cmd</code> 目录下，例如添加一个 <code>version</code> 命令（<code>cmd/version.go</code>）：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">Copyright © 2024 Kyden &lt;kytedance@gmail.com&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm">This file is part of CLI application foo.
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">cmd</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="s">&#34;github.com/spf13/cobra&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// versionCmd represents the version command
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">versionCmd</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Use</span><span class="p">:</span>   <span class="s">&#34;version&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Short</span><span class="p">:</span> <span class="s">&#34;A brief description of your command&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Long</span><span class="p">:</span> <span class="s">`A longer description that spans multiple lines and likely contains examples
</span></span></span><span class="line"><span class="cl"><span class="s">and usage of using your command. For example:
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Cobra is a CLI library for Go that empowers applications.
</span></span></span><span class="line"><span class="cl"><span class="s">This application is a tool to generate the needed files
</span></span></span><span class="line"><span class="cl"><span class="s">to quickly create a Cobra application.`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="nx">Run</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">cobra</span><span class="p">.</span><span class="nx">Command</span><span class="p">,</span> <span class="nx">args</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;version called&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rootCmd</span><span class="p">.</span><span class="nf">AddCommand</span><span class="p">(</span><span class="nx">versionCmd</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Here you will define your flags and configuration settings.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Cobra supports Persistent Flags which will work for this command
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// and all subcommands, e.g.:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// versionCmd.PersistentFlags().String(&#34;foo&#34;, &#34;&#34;, &#34;A help for foo&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Cobra supports local flags which will only run when this command
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// is called directly, e.g.:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// versionCmd.Flags().BoolP(&#34;toggle&#34;, &#34;t&#34;, false, &#34;Help message for toggle&#34;)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>编译运行</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="err">$</span> <span class="k">go</span> <span class="nx">build</span> <span class="o">-</span><span class="nx">v</span> <span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="nx">cobrademo</span> <span class="o">-</span><span class="nx">h</span>
</span></span><span class="line"><span class="cl"><span class="nx">A</span> <span class="nx">longer</span> <span class="nx">description</span> <span class="nx">that</span> <span class="nx">spans</span> <span class="nx">multiple</span> <span class="nx">lines</span> <span class="nx">and</span> <span class="nx">likely</span> <span class="nx">contains</span>
</span></span><span class="line"><span class="cl"><span class="nx">examples</span> <span class="nx">and</span> <span class="nx">usage</span> <span class="nx">of</span> <span class="nx">using</span> <span class="nx">your</span> <span class="nx">application</span><span class="p">.</span> <span class="nx">For</span> <span class="nx">example</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Cobra</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">CLI</span> <span class="nx">library</span> <span class="k">for</span> <span class="nx">Go</span> <span class="nx">that</span> <span class="nx">empowers</span> <span class="nx">applications</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="nx">This</span> <span class="nx">application</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">tool</span> <span class="nx">to</span> <span class="nx">generate</span> <span class="nx">the</span> <span class="nx">needed</span> <span class="nx">files</span>
</span></span><span class="line"><span class="cl"><span class="nx">to</span> <span class="nx">quickly</span> <span class="nx">create</span> <span class="nx">a</span> <span class="nx">Cobra</span> <span class="nx">application</span><span class="p">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Usage</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cobrademo</span> <span class="p">[</span><span class="nx">flags</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cobrademo</span> <span class="p">[</span><span class="nx">command</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Available</span> <span class="nx">Commands</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="nx">completion</span>  <span class="nx">Generate</span> <span class="nx">the</span> <span class="nx">autocompletion</span> <span class="nx">script</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">specified</span> <span class="nx">shell</span>
</span></span><span class="line"><span class="cl">  <span class="nx">help</span>        <span class="nx">Help</span> <span class="nx">about</span> <span class="nx">any</span> <span class="nx">command</span>
</span></span><span class="line"><span class="cl">  <span class="nx">helper</span>      <span class="nx">A</span> <span class="nx">brief</span> <span class="nx">description</span> <span class="nx">of</span> <span class="nx">your</span> <span class="nx">command</span>
</span></span><span class="line"><span class="cl">  <span class="nx">version</span>     <span class="nx">A</span> <span class="nx">brief</span> <span class="nx">description</span> <span class="nx">of</span> <span class="nx">your</span> <span class="nx">command</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Flags</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span><span class="nx">h</span><span class="p">,</span> <span class="o">--</span><span class="nx">help</span>     <span class="nx">help</span> <span class="k">for</span> <span class="nx">cobrademo</span>
</span></span><span class="line"><span class="cl">  <span class="o">-</span><span class="nx">t</span><span class="p">,</span> <span class="o">--</span><span class="nx">toggle</span>   <span class="nx">Help</span> <span class="nx">message</span> <span class="k">for</span> <span class="nx">toggle</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Use</span> <span class="s">&#34;cobrademo [command] --help&#34;</span> <span class="k">for</span> <span class="nx">more</span> <span class="nx">information</span> <span class="nx">about</span> <span class="nx">a</span> <span class="nx">command</span><span class="p">.</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="使用标志">使用标志</h3>
<p>cobra 可以跟 pflag 结合使用，实现强大的标志功能。
具体步骤如下：</p>
<ol>
<li>使用持久化的标志</li>
</ol>
<p>标志是可以&quot;持久化&quot;的，即该标志可用于它所分配的命令以及该命令下的每个子命令。
例如，在 <code>rootCmd</code> 中定义持久化标志：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">rootCmd</span><span class="p">.</span><span class="nf">PersistentFlags</span><span class="p">().</span><span class="nf">BoolVarP</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Verbose</span><span class="p">,</span> <span class="s">&#34;verbose&#34;</span><span class="p">,</span> <span class="s">&#34;v&#34;</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="s">&#34;verbose output&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>使用本地标志</li>
</ol>
<p>本地标志，只能在其所绑定的命令上使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">rootCmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">StringVarP</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Source</span><span class="p">,</span> <span class="s">&#34;source&#34;</span><span class="p">,</span> <span class="s">&#34;s&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;Source directory to read from&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的 <code>--source</code> 标志智能在 <code>rootCmd</code> 命令上引用，而不能在 <code>rootCmd</code> 的子命令上引用。</p>
<ol start="3">
<li>将标志绑定到 viper</li>
</ol>
<p>可以讲标志绑定到 viper，这样就可以使用 <code>viper.Get()</code> 获取标志的值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">auther</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">rootCmd</span><span class="p">.</span><span class="nf">PersistentFlags</span><span class="p">().</span><span class="nf">StringVar</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="o">&amp;</span><span class="nx">auther</span><span class="p">,</span> <span class="s">&#34;author&#34;</span><span class="p">,</span> <span class="s">&#34;Your Name&#34;</span><span class="p">,</span> <span class="s">&#34;Author name for copyright attribution&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">viper</span><span class="p">.</span><span class="nf">BindPFlag</span><span class="p">(</span><span class="s">&#34;author&#34;</span><span class="p">,</span> <span class="nx">rootCmd</span><span class="p">.</span><span class="nf">PersistentFlags</span><span class="p">().</span><span class="nf">Lookup</span><span class="p">(</span><span class="s">&#34;auther&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>设置标志为必选</li>
</ol>
<p>默认情况下，标志是可选的，也可以设置标志为必选。
当设置标志为必选时，若不提供标志时，cobra 会报错：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">rootCmd</span><span class="p">.</span><span class="nf">Flags</span><span class="p">().</span><span class="nf">StringVarP</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">Region</span><span class="p">,</span> <span class="s">&#34;region&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">,</span> <span class="s">&#34;&#34;</span><span class="p">,</span> <span class="s">&#34;AWS region (required)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">rootCmd</span><span class="p">.</span><span class="nf">MarkFlagRequired</span><span class="p">(</span><span class="s">&#34;region&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="iv-reference">IV. Reference</h2>
<ul>
<li><a href="https://github.com/spf13/cobra" target="_blank" rel="noopener noreffer ">cobra</a></li>
</ul></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-09-21</span>
            </div><div class="post-info-license">
                <span><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://kydance.github.io/posts/go-cobra/" data-title="浅析现代化命令行框架 Cobra" data-hashtags="现代化,命令行,框架,Cobra,CLI"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://kydance.github.io/posts/go-cobra/" data-hashtag="现代化"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://kydance.github.io/posts/go-cobra/"><i class="fab fa-linkedin fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://kydance.github.io/posts/go-cobra/" data-title="浅析现代化命令行框架 Cobra" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="https://kydance.github.io/posts/go-cobra/" data-title="浅析现代化命令行框架 Cobra"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Reddit" data-sharer="reddit" data-url="https://kydance.github.io/posts/go-cobra/"><i class="fab fa-reddit fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://kydance.github.io/posts/go-cobra/" data-title="浅析现代化命令行框架 Cobra"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="https://kydance.github.io/posts/go-cobra/" data-title="浅析现代化命令行框架 Cobra"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 百度" data-sharer="baidu" data-url="https://kydance.github.io/posts/go-cobra/" data-title="浅析现代化命令行框架 Cobra"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/baidu.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/%E7%8E%B0%E4%BB%A3%E5%8C%96/">现代化</a>,&nbsp;<a href="/tags/%E5%91%BD%E4%BB%A4%E8%A1%8C/">命令行</a>,&nbsp;<a href="/tags/%E6%A1%86%E6%9E%B6/">框架</a>,&nbsp;<a href="/tags/cobra/">Cobra</a>,&nbsp;<a href="/tags/cli/">CLI</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/regex-in-one/" class="prev" rel="prev" title="浅析 Regular Expression (正则表达式)"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>浅析 Regular Expression (正则表达式)</a>
            <a href="/posts/go-viper/" class="next" rel="next" title="Go 如何优雅地读取配置？">Go 如何优雅地读取配置？<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="gitalk" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://github.com/gitalk/gitalk"></a>Gitalk</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2024 - 2025</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank"></a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></br><script>
                    function siteTime() {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = 2024;
                        var startMonth = 4;
                        var startDate = 18;
                        var startHour = 12;
                        var startMinute = 57;
                        var startSecond = 2;
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);
                        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                            minutes);
                        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                            diffMinutes * minutes) / seconds);
                        if (startYear == todayYear) {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffDays + " 天 " + diffHours +
                                " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        } else {
                            
                            document.getElementById("sitetime").innerHTML = "已安全运行 " + diffYears + " 年 " + diffDays +
                                " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                        }
                    }
                    setInterval(siteTime, 1000);
                </script>
                <span id="sitetime">载入运行时间...</span>
            </div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=Array.prototype.fill%2CArray.prototype.find%2CArray.from%2CIntersectionObserver%2CMath.sign%2CObject.assign%2CPromise%2CObject.entries%2Chtml5shiv%2CObject.values%2Cfetch%2CElement.prototype.after"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/object-fit-images@3.2.4/dist/ofi.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"gitalk":{"admin":["kydance"],"clientID":"Ov23likvuyngmRCWd1hP","clientSecret":"16163c8f0ebfca715063d177b08df64f405da1db","id":"2024-09-21T09:55:48+08:00","owner":"kydance","repo":"gitalk","title":"浅析现代化命令行框架 Cobra"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"algoliaAppID":"PASDMWALPK","algoliaIndex":"index.en","algoliaSearchKey":"b42948e51daaa93df92381c8e2ac0f93","highlightTag":"em","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"algolia"}};</script><script type="text/javascript" src="/js/theme.min.d7121d72cd85153ec9d35a888cee3eb28c2700ca763f649a538f6c772d750021.js" integrity="sha256-1xIdcs2FFT7J01qIjO4+sownAMp2P2SaU49sdy11ACE="></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-M1S0PTJ6RH', { 'anonymize_ip': true });
        </script><script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=G-M1S0PTJ6RH" async></script></body>
</html>
