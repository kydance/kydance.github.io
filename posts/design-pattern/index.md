# Design Pattern


{{&lt; admonition type=abstract title=&#34;å¯¼è¯­&#34; open=true &gt;}}
è®¾è®¡æ¨¡å¼: åœ¨ç‰¹å®šçŽ¯å¢ƒä¸‹äººä»¬è§£å†³æŸç±»é‡å¤å‡ºçŽ°çš„ä¸€å¥—æˆåŠŸæˆ–æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ.
{{&lt; /admonition &gt;}}

&lt;!--more--&gt;

## I. å‰è¨€

è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼Œæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ï¼Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£å¹¶ä¸”ä¿è¯ä»£ç å¯é æ€§ã€‚
ç®€å•æ¥è¯´ï¼Œè®¾è®¡æ¨¡å¼å°±æ˜¯**åœ¨ä¸€å®šçŽ¯å¢ƒä¸‹ï¼Œç”¨å›ºå®šå¥—è·¯è§£å†³é—®é¢˜**ã€‚

&gt; è®¾è®¡æ¨¡å¼çš„åŸºç¡€ï¼š**å¤šæ€**

### é¢å‘å¯¹è±¡è®¾è®¡åŽŸåˆ™

    &gt; ç›®çš„ï¼šé«˜å†…èšã€ä½Žè€¦åˆ

å¦‚ä½•åŒæ—¶æâ¾¼â¼€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„**å¯ç»´æŠ¤æ€§**å’Œ**å¯å¤â½¤æ€§**æ˜¯â¾¯å‘å¯¹è±¡è®¾è®¡éœ€è¦è§£å†³çš„æ ¸â¼¼é—®é¢˜ä¹‹â¼€ã€‚
â¾¯å‘å¯¹è±¡è®¾è®¡åŽŸåˆ™ä¸ºâ½€æŒå¯ç»´æŠ¤æ€§å¤â½¤â½½è¯žâ½£ï¼Œè¿™äº›åŽŸåˆ™è•´å«åœ¨å¾ˆå¤šè®¾è®¡æ¨¡å¼ä¸­ï¼Œå®ƒä»¬æ˜¯ä»Žè®¸å¤šè®¾è®¡â½…æ¡ˆä¸­æ€»ç»“å‡ºçš„æŒ‡å¯¼æ€§åŽŸåˆ™ã€‚

- å•ä¸€èŒè´£åŽŸåˆ™: ç±»çš„èŒè´£å•â¼€ï¼Œå¯¹å¤–åªæä¾›â¼€ç§åŠŸèƒ½ï¼Œâ½½å¼•èµ·ç±»å˜åŒ–çš„åŽŸå› éƒ½åº”è¯¥åªæœ‰â¼€ä¸ª
- å¼€é—­åŽŸåˆ™: **ç±»çš„æ”¹åŠ¨æ˜¯é€šè¿‡å¢žåŠ ä»£ç è¿›â¾çš„ï¼Œâ½½ä¸æ˜¯ä¿®æ”¹æºä»£ç **
- é‡Œå¼ä»£æ¢åŽŸåˆ™: ä»»ä½•æŠ½è±¡ç±»å‡ºçŽ°çš„åœ°â½…éƒ½å¯ä»¥â½¤ä»–çš„å®žçŽ°ç±»è¿›â¾æ›¿æ¢ï¼Œå®žé™…å°±æ˜¯è™šæ‹Ÿæœºåˆ¶ï¼Œè¯­â¾”çº§åˆ«å®žçŽ°â¾¯å‘å¯¹è±¡åŠŸèƒ½
- ä¾èµ–å€’è½¬åŽŸåˆ™: **ä¾èµ–äºŽæŠ½è±¡(æŽ¥â¼)ï¼Œä¸è¦ä¾èµ–å…·ä½“çš„å®žçŽ°(ç±»)ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹æŽ¥â¼ç¼–ç¨‹**
- æŽ¥å£éš”ç¦»åŽŸåˆ™: ä¸åº”è¯¥å¼ºè¿«â½¤æˆ·çš„ç¨‹åºä¾èµ–ä»–ä»¬ä¸éœ€è¦çš„æŽ¥â¼â½…æ³•ã€‚â¼€ä¸ªæŽ¥â¼åº”è¯¥åªæä¾›â¼€ç§å¯¹å¤–åŠŸèƒ½ï¼Œä¸åº”è¯¥æŠŠæ‰€æœ‰æ“ä½œéƒ½å°è£…åˆ°â¼€ä¸ªæŽ¥â¼ä¸­åŽ»
- åˆæˆå¤ç”¨åŽŸåˆ™: å¦‚æžœä½¿â½¤ç»§æ‰¿ï¼Œä¼šå¯¼è‡´â½—ç±»çš„ä»»ä½•å˜æ¢éƒ½å¯èƒ½å½±å“åˆ°â¼¦ç±»çš„â¾ä¸ºã€‚å¦‚æžœä½¿â½¤å¯¹è±¡ç»„åˆï¼Œå°±é™ä½Žäº†è¿™ç§ä¾èµ–å…³ç³»ã€‚**å¯¹äºŽç»§æ‰¿å’Œç»„åˆï¼Œä¼˜å…ˆä½¿â½¤ç»„åˆ**
- è¿ªç±³ç‰¹æ³•åˆ™: **â¼€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡å°½å¯èƒ½å°‘çš„äº†è§£ï¼Œä»Žâ½½é™ä½Žå„ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆï¼Œæâ¾¼ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§**

## II. åˆ†ç±»

- åˆ›å»ºåž‹ï¼ˆCreationalï¼‰æ¨¡å¼ï¼šå¦‚ä½•åˆ›å»ºå¯¹è±¡

| æ¨¡å¼åç§° | ç”¨é€” |
| :--- | :--- |
| **å•ä¾‹æ¨¡å¼** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸðŸŒŸ | ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ |
| **ç®€å•å·¥åŽ‚æ–¹æ³•** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸ | é€šè¿‡ä¸“é—¨å®šä¹‰ä¸€ä¸ªç±»æ¥è´Ÿè´£åˆ›å»ºå…¶ä»–ç±»çš„å®žä¾‹ï¼Œè¢«åˆ›å»ºçš„å®žä¾‹é€šå¸¸éƒ½å…·æœ‰å…±åŒçš„åŸºç±» |
| **æŠ½è±¡å·¥åŽ‚æ–¹æ³•** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ | æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„æŽ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±» |
| åŽŸåž‹æ¨¡å¼ | â½¤åŽŸåž‹å®žä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·â»‰è¿™äº›åŽŸåž‹åˆ›å»ºæ–°çš„å¯¹è±¡ |
| å»ºé€ è€…æ¨¡å¼ | å°†â¼€ä¸ªå¤æ‚çš„æž„å»ºä¸Žå…¶è¡¨ç¤ºç›¸åˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æž„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤º |

- ç»“æž„åž‹ï¼ˆStructuralï¼‰æ¨¡å¼ï¼šå¦‚ä½•å®žçŽ°ç±»æˆ–å¯¹è±¡çš„ç»„åˆ

| æ¨¡å¼åç§° | ç”¨é€” |
| :--- | :--- |
| **é€‚é…å™¨æ¨¡å¼** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸðŸŒŸ | å°†ä¸€ä¸ªç±»çš„æŽ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæŽ¥å£ï¼Œä½¿å¾—åŽŸæœ¬ç”±äºŽæŽ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ |
| æ¡¥æŽ¥æ¨¡å¼ | å°†æŠ½è±¡éƒ¨åˆ†ä¸Žå®žé™…éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹çš„å˜åŒ– |
| **ç»„åˆæ¨¡å¼** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸðŸŒŸ | å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æž„ä»¥è¡¨ç¤º â€œéƒ¨åˆ† - æ•´ä½“â€ çš„å±‚æ¬¡ç»“æž„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ |
| **è£…é¥°æ¨¡å¼** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸ | åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼šå°±å¢žåŠ åŠŸèƒ½æ¥è¯´ï¼Œæ­¤æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»æ›´åŠ çµæ´» |
| **å¤–è§‚æ¨¡å¼** &lt;br&gt; ðŸŒŸðŸŒŸðŸŒŸðŸŒŸðŸŒŸ | ä¸ºå­ç³»ç»Ÿçš„ä¸€ç»„æŽ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ï¼Œæ­¤æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¬¡æŽ¥å£ï¼Œä½¿å¾—è¿™ä¸€å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ |
| äº«å…ƒæ¨¡å¼ | ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆçš„æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦çš„å¯¹è±¡ |
| ä»£ç†æ¨¡å¼ | ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æŽ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—® |

- è¡Œä¸ºåž‹ï¼ˆBehavioralï¼‰æ¨¡å¼ï¼šç±»æˆ–å¯¹è±¡å¦‚ä½•äº¤äº’ä»¥åŠå¦‚ä½•åˆ†é…æŒ‡è´£

## III. åˆ›å»ºåž‹è®¾è®¡æ¨¡å¼

### 1. å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰

æ„å›¾ï¼šå®ƒæ˜¯ä¸€ç§åˆ›å»ºåž‹è®¾è®¡æ¨¡å¼ï¼Œé™åˆ¶äº†å®žä¾‹åŒ–ç±»çš„å¯¹è±¡ä¸ªæ•°ï¼Œç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚

{{&lt; admonition type=warning title=&#34;warning&#34; open=true &gt;}}

Singleton Pattern åŒæ—¶è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼Œå› æ­¤è¿æ³•äº†**å•ä¸€èŒè´£åŽŸåˆ™**:

1. ä¿è¯ä¸€ä¸ªç±»åªç”¨ä¸€ä¸ªå®žä¾‹ã€‚
2. ä¸ºè¯¥å®žä¾‹æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®èŠ‚ç‚¹ã€‚

{{&lt; /admonition &gt;}}

#### åº”ç”¨åœºæ™¯

- é…ç½®ç®¡ç†å™¨ï¼šåœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œé…ç½®ä¿¡æ¯é€šå¸¸éœ€è¦ä¸€ä¸ªå®žä¾‹æ¥ç®¡ç†ï¼Œå¦‚æ­¤å¯ä»¥ä¿è¯é…ç½®ä¿¡æ¯çš„ä¸€è‡´æ€§
- è¿žæŽ¥æ± ï¼šæ•°æ®åº“è¿žæŽ¥æ± éœ€è¦é™åˆ¶æ•°æ®åº“è¿žæŽ¥çš„æ•°é‡ï¼Œä»¥é¿å…è¿‡å¤šçš„è¿žæŽ¥æ¶ˆè€—èµ„æº
- æ—¥å¿—è®°å½•å™¨ï¼šæ—¥å¿—ç³»ç»Ÿé€šå¸¸åªéœ€è¦ä¸€ä¸ªå®žä¾‹æ¥è®°å½•åº”ç”¨ç¨‹åºçš„æ—¥å¿—ä¿¡æ¯ï¼Œä»¥é¿å…æ—¥å¿—ä¿¡æ¯çš„å†—ä½™å’Œæ··ä¹±
- ç¡¬ä»¶ç®¡ç†å™¨ï¼šå¯¹äºŽæŸäº›ç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚æ‰“å°æœº / æ‰«æä»ªç­‰ï¼Œå¯èƒ½åªéœ€è¦ä¸€ä¸ªç®¡ç†å™¨æ¥æŽ§åˆ¶å¯¹å®ƒä»¬çš„è®¿é—®
- åº”ç”¨çŠ¶æ€ç®¡ç†ï¼šåœ¨æŸäº›åº”ç”¨ä¸­ï¼Œéœ€è¦å…¨å±€çš„ç®¡ç†çŠ¶æ€ï¼Œå¦‚ç”¨æˆ·ä¼šè¯ç®¡ç†æˆ–æƒé™éªŒè¯çŠ¶æ€

#### è§£å†³æ–¹æ¡ˆ

- å°†é»˜è®¤æž„é€ å‡½æ•°è®¾ä¸ºç§æœ‰ï¼Œé˜²æ­¢å…¶ä»–å¯¹è±¡ä½¿ç”¨å•ä¾‹ç±»çš„ `new` è¿ç®—ç¬¦
- æ–°å»ºä¸€ä¸ªé™æ€æž„å»ºæ–¹æ³•ä½œä¸ºæž„é€ å‡½æ•°ï¼šè¯¥å‡½æ•°ä¼šâ€œå·å·â€è°ƒç”¨ç§æœ‰æž„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°ä¸€ä¸ªé™æ€æˆå‘˜å˜é‡ä¸­ï¼Œä¹‹åŽæ‰€æœ‰å¯¹äºŽè¯¥å‡½æ•°çš„è°ƒç”¨éƒ½å°†è¿”å›žè¿™ä¸€ç¼“å­˜å¯¹è±¡ã€‚

#### å•ä¾‹æ¨¡å¼ç»“æž„

{{&lt; figure src=&#34;/posts/design-pattern/FactoryMethod-Singleton.svg&#34; title=&#34;&#34; &gt;}}

#### ä¸Žå…¶ä»–æ¨¡å¼çš„å…³ç³»

- **å¤–è§‚æ¨¡å¼**ç±»é€šå¸¸å¯ä»¥è½¬åŒ–ä¸º**å•ä¾‹æ¨¡å¼**ç±»ï¼Œå› ä¸ºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸€ä¸ªå¤–è§‚å¯¹è±¡å°±è¶³å¤Ÿå•¦
- å¦‚æžœèƒ½å°†å¯¹è±¡çš„æ‰€æœ‰å…±äº«çŠ¶æ€ç®€åŒ–ä¸ºä¸€ä¸ªäº«å…ƒå¯¹è±¡ï¼Œé‚£ä¹ˆ**äº«å…ƒæ¨¡å¼**å°±å’Œ**å•ä¾‹**ç±»ä¼¼ï¼Œä½†äºŒè€…æœ‰ä¸¤ä¸ªæ ¹æœ¬æ€§çš„ä¸åŒï¼š
	1. å•ä¾‹åªæœ‰ä¸€ä¸ªå•ä¾‹å®žä½“ï¼Œä½†äº«å…ƒç±»å¯ä»¥æœ‰å¤šä¸ªå®žä½“ï¼Œå„å®žä½“çš„å†…åœ¨çŠ¶æ€ä¹Ÿå¯ä»¥ä¸åŒ
	2. å•ä¾‹å¯¹è±¡å¯ä»¥æ˜¯å¯å˜çš„ï¼Œäº«å…ƒå¯¹è±¡ä¸å¯å˜
- **æŠ½è±¡å·¥åŽ‚æ¨¡å¼**ã€**ç”Ÿæˆå™¨æ¨¡å¼**å’Œ**åŽŸåž‹æ¨¡å¼**éƒ½å¯ä»¥ç”¨**å•ä¾‹**æ¥å®žçŽ°

#### åº”ç”¨ç¤ºä¾‹

```Go
// {{&lt; link &#34;/posts/design-pattern/singleton.go&#34; &#34;singleton.go&#34; &gt;}}

package designpattern

import &#34;sync&#34;

var once sync.Once

type Singleton struct {
	str string
}

var instance *Singleton

func GetInstance() *Singleton {
	if instance != nil {
		return instance
	}

	once.Do(func() {
		instance = &amp;Singleton{}
	})
	return instance
}
```

### 2. ç®€å•å·¥åŽ‚æ¨¡å¼

äº¦ç§°ï¼šè™šæ‹Ÿæž„é€ å‡½æ•°ã€Virtual Constructorã€Factory Method

æ„å›¾ï¼šå®ƒæ˜¯ä¸€ç§åˆ›å»ºåž‹è®¾è®¡æ¨¡å¼ï¼Œ**å…¶åœ¨çˆ¶ç±»ä¸­æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œå…è®¸å­ç±»å†³å®šå®žä¾‹åŒ–å¯¹è±¡çš„ç±»åž‹**

NOTE: ç”±äºŽ Golang ä¸­ç¼ºå°‘ç±»å’Œç»§æ‰¿ç­‰ OOP ç‰¹æ€§ï¼Œå› æ­¤ï¼Œæ— æ³•ä½¿ç”¨ Go æ¥å®žçŽ°ç»å…¸çš„å·¥åŽ‚æ–¹æ³•æ¨¡å¼ï¼Œä½†æˆ‘ä»¬ä»èƒ½å®žçŽ°åŸºç¡€ç‰ˆæœ¬ï¼Œå³ç®€å•å·¥åŽ‚ã€‚

### 3. è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserverï¼‰

äº¦ç§°ï¼šäº‹ä»¶è®¢é˜…è€…ã€ç›‘å¬è€…ã€Event-Subscriberã€Listener

æ„å›¾ï¼šå®ƒæ˜¯ä¸€ç§è¡Œä¸ºåž‹è®¾è®¡æ¨¡å¼ï¼Œå…è®¸å®šä¹‰ä¸€ç§è®¢é˜…æœºåˆ¶ï¼Œå¯åœ¨å¯¹è±¡äº‹ä»¶å‘ç”Ÿæ—¶é€šçŸ¥å¤šä¸ª â€œè§‚å¯Ÿâ€ è¯¥å¯¹è±¡çš„å…¶ä»–å¯¹è±¡ã€‚

æ‹¥æœ‰ä¸€äº›å€¼å¾—å…³æ³¨çš„å¯¹è±¡é€šå¸¸è¢«ç§°ä¸º**ç›®æ ‡**ï¼Œç”±äºŽå®ƒè¦å°†è‡ªèº«çŠ¶æ€çš„å˜åŒ–é€šçŸ¥ç»™å…¶ä»–å¯¹è±¡ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º**å‘å¸ƒè€…(publisher)**ï¼Œè€Œå…¶ä»–å…³æ³¨å‘å¸ƒè€…çŠ¶æ€å˜åŒ–çš„å¯¹è±¡è¢«ç§°ä¸º**è®¢é˜…è€…(subscriber)**

{{&lt; admonition type=Note title=&#34;Observer æ ¸å¿ƒæœºåˆ¶&#34; open=true &gt;}}
Observer æ¨¡å¼å»ºè®®ä¸ºå‘å¸ƒè€…ç±»æ·»åŠ è®¢é˜…æœºåˆ¶ï¼Œè®©æ¯ä¸ªå¯¹è±¡éƒ½èƒ½è®¢é˜…æˆ–å–æ¶ˆè®¢é˜…å‘å¸ƒè€…äº‹ä»¶æµã€‚

å®žé™…ä¸Šï¼Œè¯¥æœºåˆ¶åŒ…æ‹¬ï¼š

1. ä¸€ä¸ªç”¨äºŽå­˜å‚¨è®¢é˜…è€…å¯¹è±¡å¼•ç”¨çš„åˆ—è¡¨æˆå‘˜å˜é‡
2. å‡ ä¸ªç”¨äºŽæ·»åŠ æˆ–åˆ é™¤è¯¥åˆ—è¡¨ä¸­è®¢é˜…è€…çš„å…¬æœ‰æ–¹æ³•
{{&lt; /admonition &gt;}}


---

> : [kyden](https:github.com/kydance)  
> URL: http://kyden.us.kg/posts/design-pattern/  

